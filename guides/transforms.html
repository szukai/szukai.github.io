<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transforms and Filters | Kloudless Custom Connector</title>
    <meta name="description" content="Custom Connector Documentation">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/kl-logo.png">
    <link rel="preload" href="/assets/css/0.styles.4e2df076.css" as="style"><link rel="preload" href="/assets/js/app.a00be1cb.js" as="script"><link rel="preload" href="/assets/js/2.119f2a7d.js" as="script"><link rel="preload" href="/assets/js/10.0f7f8ee2.js" as="script"><link rel="prefetch" href="/assets/js/11.516aefc8.js"><link rel="prefetch" href="/assets/js/12.3beb3639.js"><link rel="prefetch" href="/assets/js/13.fb7bd892.js"><link rel="prefetch" href="/assets/js/14.df68b497.js"><link rel="prefetch" href="/assets/js/15.a6f693ec.js"><link rel="prefetch" href="/assets/js/3.59865c7b.js"><link rel="prefetch" href="/assets/js/4.d91d60a9.js"><link rel="prefetch" href="/assets/js/5.41b48d48.js"><link rel="prefetch" href="/assets/js/6.d05e96e2.js"><link rel="prefetch" href="/assets/js/7.340bdfb7.js"><link rel="prefetch" href="/assets/js/8.f52965a5.js"><link rel="prefetch" href="/assets/js/9.a64800f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4e2df076.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kloudless Custom Connector</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Intro
</a></div><div class="nav-item"><a href="/guides/quickstart-storage.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/reference/kspec-ref.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="https://kloudless.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kloudless API
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Intro
</a></div><div class="nav-item"><a href="/guides/quickstart-storage.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/reference/kspec-ref.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="https://kloudless.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kloudless API
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guides</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guides/quickstart-storage.html" class="sidebar-link">Quickstart</a></li><li><a href="/guides/transforms.html" class="active sidebar-link">Transforms</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/transforms.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#transforms-an-example" class="sidebar-link">Transforms: An Example</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/transforms.html#transform-objects" class="sidebar-link">Transform Objects</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#bidirectional-mapping" class="sidebar-link">Bidirectional Mapping</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#unidirectional-mapping" class="sidebar-link">Unidirectional Mapping</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#transform-object-inheritance" class="sidebar-link">Transform Object Inheritance</a></li></ul></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#jinja-common-usages" class="sidebar-link">Jinja Common Usages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/transforms.html#variables" class="sidebar-link">Variables</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#filters" class="sidebar-link">Filters</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#if" class="sidebar-link">If</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#assignment" class="sidebar-link">Assignment</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#context" class="sidebar-link">Context</a></li></ul></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#jinja-filter-extensions" class="sidebar-link">Jinja Filter Extensions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/transforms.html#ref-transform" class="sidebar-link">ref_transform()</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#timestring-to-unix" class="sidebar-link">timestring_to_unix()</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#timestring-to-datetime" class="sidebar-link">timestring_to_datetime()</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#expires-in-to-expiry" class="sidebar-link">expires_in_to_expiry()</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#maybe-get" class="sidebar-link">maybe_get()</a></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#customized-jinja-filters" class="sidebar-link">Customized Jinja Filters</a></li></ul></li><li class="sidebar-sub-header"><a href="/guides/transforms.html#transforms-exceptions" class="sidebar-link">Transforms Exceptions</a></li></ul></li><li><a href="/guides/authentication.html" class="sidebar-link">Authentication</a></li><li><a href="/guides/pre-auth-form.html" class="sidebar-link">Pre-Auth Form</a></li><li><a href="/guides/activities.html" class="sidebar-link">Activities</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="transforms-and-filters"><a href="#transforms-and-filters" class="header-anchor">#</a> Transforms and Filters</h1> <p></p><div class="table-of-contents"><ul><li><a href="#overview">Overview</a></li><li><a href="#transforms-an-example">Transforms: An Example</a><ul><li><a href="#transform-objects">Transform Objects</a></li><li><a href="#bidirectional-mapping">Bidirectional Mapping</a></li><li><a href="#unidirectional-mapping">Unidirectional Mapping</a></li><li><a href="#transform-object-inheritance">Transform Object Inheritance</a></li></ul></li><li><a href="#jinja-common-usages">Jinja Common Usages</a><ul><li><a href="#variables">Variables</a></li><li><a href="#filters">Filters</a></li><li><a href="#if">If</a></li><li><a href="#assignment">Assignment</a></li><li><a href="#context">Context</a></li></ul></li><li><a href="#jinja-filter-extensions">Jinja Filter Extensions</a><ul><li><a href="#ref-transform">ref_transform()</a></li><li><a href="#timestring-to-unix">timestring_to_unix()</a></li><li><a href="#timestring-to-datetime">timestring_to_datetime()</a></li><li><a href="#expires-in-to-expiry">expires_in_to_expiry()</a></li><li><a href="#maybe-get">maybe_get()</a></li><li><a href="#customized-jinja-filters">Customized Jinja Filters</a></li></ul></li><li><a href="#transforms-exceptions">Transforms Exceptions</a></li></ul></div><p></p> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>Kloudless uses Transforms to help convert data structures and formats to
and from the upstream service:</p> <ul><li>POST/PATCH/PUT: &quot;Common&quot; input data from the developer gets converted into a
&quot;detailed&quot; format of upstream service.</li> <li>GET: &quot;Detailed&quot; input data from the upstream service and output to the
developer in a &quot;common&quot; format.</li></ul> <h2 id="transforms-an-example"><a href="#transforms-an-example" class="header-anchor">#</a> Transforms: An Example</h2> <p>Let us start with an example Transforms.</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>In this example, the fields in CamelCase (<code>Id</code>, <code>Owner</code>, <code>Email</code>, etc.) belong
to the upstream object and the snake_case fields (<code>id</code>, <code>owner</code>,
<code>profile.email</code> etc.) belong to the Kloudless unified object.</p> <p>The following fields are parts of Kloudless Specification (KSpec) syntax which
define the behaviors of the Transforms:</p> <ul><li><code>transforms</code><br>
Contains all the <a href="#transform-objects">Transform Objects</a>.</li> <li><code>bidirectional</code><br>
This defines one-to-one mappings between one upstream field and one
kloudless field. <code>Bidirectional</code> fields can be transformed in both directions
(from-upstream direction or to-upstream direction). Check
<a href="#bidirectional-mapping">Bidirectional Mapping</a> for details.</li> <li><code>from_upstream</code> and <code>to_upstream</code><br>
These two fields define one direction mappings. Single direction mappings
work in either the from-upstream direction or the to-upstream direction only.
This YAML object contains a multi-line string
<a href="http://jinja.pocoo.org/docs" target="_blank" rel="noopener noreferrer">Jinja2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> variable. It utilizes the Jinja2
template engine. Capabilities supported by the Jinja2 syntax E.g. <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#if" target="_blank" rel="noopener noreferrer">if
statement<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
<a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#filters" target="_blank" rel="noopener noreferrer">filters<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
<a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#assignments" target="_blank" rel="noopener noreferrer">assignment<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
etc. can be leveraged inside the <code>from_upstream</code> and <code>to_upstream</code> fields.
Check <a href="#unidirectional-mapping">Unidirectional Mapping</a> and <a href="#jinja-common-usages">Jinja Common
Usages</a> for details.</li> <li><code>parents</code><br>
A list of <a href="#transform-objects">Transform Object</a> names. This Transform
Object inherits the transformation from its parents' Transform Objects to
keep things DRY for common fields (See
<a href="#transform-object-inheritance">Inheritance</a>).</li></ul> <h3 id="transform-objects"><a href="#transform-objects" class="header-anchor">#</a> Transform Objects</h3> <p>A Transform Object represents a mapping between an upstream object and a
Kloudless unified object. A Transform Object is a YAML object where the
transformation's name and behaviors are mapped to its key and value,
respectively. The transformation's value is composed of four parts:
<code>bidirectional</code>, <code>from_upstream</code>, <code>to_upstream</code> and <code>parents</code>, as mentioned
above in <a href="#transforms-an-example">Transforms: An Example</a>.</p> <p>In the example below, there are two Transform Objects: <code>base_object</code> and
<code>account</code>.</p> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>base_object</code> and <code>account</code> are the names of the Transform Objects. A unique
name is needed for each Transform Object. The name of Transform Object
is used as a reference in the <a href="/guides/quickstart-storage.html#python-sdk-script">Python SDK
Script</a> and <a href="#transform-object-inheritance">Transform Object
Inheritance</a>.</p> <h3 id="bidirectional-mapping"><a href="#bidirectional-mapping" class="header-anchor">#</a> Bidirectional Mapping</h3> <p>Let us take a look at the <code>bidirectional</code> field in <code>base_object</code>.</p> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>With these definitions in this <code>bidirectional</code> field, you can do the
following transformations in the from-upstream direction:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">&quot;Id&quot;</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">&quot;Owner&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token string">&quot;Id&quot;</span><span class="token punctuation">:</span> <span class="token number">234</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">&quot;Email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;foo@boo.com&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">&quot;CreatedTime&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-03-26T16:21:59.342974+08:00&quot;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> kloudless_data <span class="token operator">=</span> client<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>from_upstream<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'base_object'</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     upstream_data<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     include_raw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data
<span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
 <span class="token string">'owner'</span><span class="token punctuation">:</span> <span class="token number">234</span><span class="token punctuation">,</span>
 <span class="token string">'profile'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'foo@boo.com'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token string">'created'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">342974</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span><span class="token operator">&lt;</span>UTC<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>The transformation works in the to-upstream direction as well.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">678</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'owner'</span><span class="token punctuation">:</span> <span class="token number">789</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'profile'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'example@to-upstream.com'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'created'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> client<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>to_upstream<span class="token punctuation">(</span><span class="token string">'base_object'</span><span class="token punctuation">,</span> kloudless_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">'CreatedTime'</span><span class="token punctuation">:</span> <span class="token string">'2020-03-26T18:24:53.254256'</span><span class="token punctuation">,</span>
 <span class="token string">'Email'</span><span class="token punctuation">:</span> <span class="token string">'example@to-upstream.com'</span><span class="token punctuation">,</span>
 <span class="token string">'Id'</span><span class="token punctuation">:</span> <span class="token number">678</span><span class="token punctuation">,</span>
 <span class="token string">'Owner'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'Id'</span><span class="token punctuation">:</span> <span class="token number">789</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Let's go through each line under <code>bidirectional</code> in detail. For simplicity,
we will focus on the from-upstream direction only.</p> <div class="custom-block tip"><p class="custom-block-title">Python SDK Script</p> <p>We demonstrate how the Transform Object works with our <a href="/guides/quickstart-storage.html#python-sdk-script">Python SDK
Script</a>.</p></div> <h4 id="simple-bidirectional-mapping"><a href="#simple-bidirectional-mapping" class="header-anchor">#</a> Simple Bidirectional Mapping</h4> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>This line means the value of <code>upstream_data['Id']</code> will be assigned to
<code>kloudless_data['id']</code>.</p> <h4 id="nested-bidirectional-mapping"><a href="#nested-bidirectional-mapping" class="header-anchor">#</a> Nested Bidirectional Mapping</h4> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>These two lines work similarly to the <a href="#simple-bidirectional-mapping">Simple Bidirectional
Mapping</a> example above. The difference is
the <code>.</code> between <code>Owner</code> and <code>Id</code>. <code>Owner.Id</code> represents the nested field, <code>Id</code>,
in the <code>Owner</code> Object.</p> <p>Therefore, line 5 means the value of <code>upstream_data['Owner']['Id']</code> will be
assigned to <code>kloudless_data['id']</code>.</p> <p>Line 6 means the value of <code>upstream_data['Email']</code> will be assigned to
<code>kloudless_data['profile']['email']</code>.</p> <p>If the upstream field name contains <code>.</code>, you can escape the <code>.</code> character with
<code>\</code>. For example, if upstream field name is <code>Foo.Boo</code>, then you should define
the field name in <code>bidirectional</code> as <code>Foo\.Boo</code>.</p> <h4 id="upstream-value-type"><a href="#upstream-value-type" class="header-anchor">#</a> Upstream Value Type</h4> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Notice the new format, <code>[CreatedTime, Iso8601]</code>. The <code>Iso8601</code> is the
Value Type of upstream value.</p> <p>By explicitly defining the Value Type, Kloudless Transforms can parse the ISO
8601 string and convert it into a Python <code>datetime</code> object.</p> <h3 id="unidirectional-mapping"><a href="#unidirectional-mapping" class="header-anchor">#</a> Unidirectional Mapping</h3> <p>This section explains the <code>from_upstream</code> and <code>to_upstream</code> parts.</p> <h4 id="from-upstream-direction"><a href="#from-upstream-direction" class="header-anchor">#</a> From-Upstream Direction</h4> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>from_upstream</code>'s value consists of a YAML multi-line string which is
rendered by <a href="http://jinja.pocoo.org/docs" target="_blank" rel="noopener noreferrer">Jinja2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><code>{{ data|maybe_get('Server', 'Domain') }}</code> is an
<a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#synopsis" target="_blank" rel="noopener noreferrer">expression<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
<code>data</code> is a
<a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#variables" target="_blank" rel="noopener noreferrer">variable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
modified by the <code>maybe_get()</code> <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#filters" target="_blank" rel="noopener noreferrer">filter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>The <code>maybe_get()</code> filter will retrieve a value from a dictionary key but will
get the multi-level nested value in the dictionary object, or return a default
value if the key/value is otherwise absent.</p> <p>Below is how this example of <code>from_upstream</code> works if the nested value
persists:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Server&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;Domain&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://demo.com&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data <span class="token operator">=</span> client<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>from_upstream<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'base_object'</span><span class="token punctuation">,</span> upstream_data<span class="token punctuation">,</span> include_raw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data
<span class="token punctuation">{</span><span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'http://demo.com'</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>If the nested value is absent, the default value, <code>None</code>, is then assigned
instead.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Server'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data <span class="token operator">=</span> client<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>from_upstream<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'base_object'</span><span class="token punctuation">,</span> upstream_data<span class="token punctuation">,</span> include_raw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data
<span class="token punctuation">{</span><span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Check <a href="#maybe-get">maybe_get()</a> for more details.</p> <h4 id="to-upstream-direction"><a href="#to-upstream-direction" class="header-anchor">#</a> To-Upstream Direction</h4> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>to_upstream</code> is very similar to <code>from_upstream</code>. The value of <code>to_upstream</code>
is also a YAML multi-line string which is rendered by
<a href="http://jinja.pocoo.org/docs" target="_blank" rel="noopener noreferrer">Jinja2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and the only difference is the
transformation direction.</p> <p>We use Jinja2's <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#if-expression" target="_blank" rel="noopener noreferrer">if
expression<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
in <code>to_upstream</code>. In this expression, <code>upstream_data['Phone']</code> will be
<code>kloudless_data['profile']['phone']</code>
if <code>kloudless_data['profile']['type'] == 'phone'</code>. Otherwise,
<code>upstream_data['Phone']</code> will be <code>-1</code>.</p> <p>The following script demonstrates when
<code>kloudless_data['profile']['type'] == 'phone'</code>:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'profile'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'phone'</span><span class="token punctuation">:</span> <span class="token string">'0123456789'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'phone'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data <span class="token operator">=</span> client<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>to_upstream<span class="token punctuation">(</span><span class="token string">'base_object'</span><span class="token punctuation">,</span> kloudless_data<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data
<span class="token punctuation">{</span><span class="token string">'Phone'</span><span class="token punctuation">:</span> <span class="token string">'0123456789'</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>If <code>kloudless_data['profile']['type'] != 'phone'</code>, this is what happens:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'profile'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'6246 Roberts Heights\nTaylorland, DC 84720'</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'address'</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data <span class="token operator">=</span> client<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>to_upstream<span class="token punctuation">(</span><span class="token string">'base_object'</span><span class="token punctuation">,</span> kloudless_data<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data
<span class="token punctuation">{</span><span class="token string">'Phone'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>For those unfamiliar with Jinja, please check
<a href="#jinja-common-usages">Jinja Common Usage</a> for more examples.</p> <h3 id="transform-object-inheritance"><a href="#transform-object-inheritance" class="header-anchor">#</a> Transform Object Inheritance</h3> <p>The upstream objects usually share some common fields (e.g. <code>Id</code>,
<code>CreatedAt</code>, <code>ModifiedAt</code>, etc.), and it may be a hassle to redefine those
common fields for each Transform Object. Fortunately, the Kloudless
Specification supports Transform Object inheritance.</p> <div class="language-yml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div></div><pre class="language-yml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_object</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">id</span><span class="token punctuation">:</span> Id
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> Owner.Id
      <span class="token key atrule">profile.email</span><span class="token punctuation">:</span> Email
      <span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CreatedTime<span class="token punctuation">,</span> Iso8601<span class="token punctuation">]</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      domain: {{ data|maybe_get('Server', 'Domain') }}</span>
    <span class="token key atrule">to_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      Phone: {{ data.profile.phone if data.profile.type == 'phone' else -1}}</span>
  <span class="token key atrule">account</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_object
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> AccountName</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The <code>account</code> Transform Object inherits the <code>base_object</code> as specified in the
<code>parents</code> array. Every transformation defined in <code>base_object</code>
also applies to the <code>account</code> object. The <code>account</code> also extends the
<code>base_object</code> with an extra bidirectional mapping on line 17.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upstream_data <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">&quot;Id&quot;</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">&quot;AccountName&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Foo&quot;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data <span class="token operator">=</span> client<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>from_upstream<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'account'</span><span class="token punctuation">,</span> upstream_data<span class="token punctuation">,</span> include_raw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> kloudless_data
<span class="token punctuation">{</span><span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Foo'</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>From the Python script above, you can see that <code>kloudless_data</code>
includes <code>domain</code> and <code>id</code> fields which are defined by <code>base_object</code>, the
<code>name</code> field is defined by <code>account</code>.</p> <div class="custom-block tip"><p class="custom-block-title">Multiple inheritances</p> <p>You can also define a Transform Object which inherits more than one parent.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">base_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">field_1</span><span class="token punctuation">:</span> Field1
  <span class="token key atrule">base_2</span><span class="token punctuation">:</span>
    <span class="token key atrule">bidirectional</span><span class="token punctuation">:</span>
      <span class="token key atrule">field_2</span><span class="token punctuation">:</span> Field2
  <span class="token key atrule">child</span><span class="token punctuation">:</span>
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> base_1
      <span class="token punctuation">-</span> base_2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div> <h2 id="jinja-common-usages"><a href="#jinja-common-usages" class="header-anchor">#</a> Jinja Common Usages</h2> <p>This section will cover some commonly used Jinja syntax examples. With these
examples, you should be able to handle most of the use cases during
transformations.</p> <div class="custom-block danger"><p class="custom-block-title">Transformation exceptions</p> <p>There are a few differences between the Kloudless Transforms and the
<a href="http://jinja.pocoo.org/docs" target="_blank" rel="noopener noreferrer">Jinja2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> template. Please refer to the
<a href="#transforms-exceptions">exceptions</a> below.</p></div> <h3 id="variables"><a href="#variables" class="header-anchor">#</a> Variables</h3> <p>This is the most basic usage of the Jinja syntax.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">foo</span><span class="token punctuation">:</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      name: {{ data.Profile.Name }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This example gets the value of <code>data['Profile']['Name']</code> and assigns
the value to the <code>name</code> field of Kloudless unified object.</p> <p><code>data</code> represents an upstream source object in the from-upstream direction. If
the field was a to-upstream transformation, then <code>data</code> would be a
Kloudless unified object instead.</p> <p>Check
<a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#variables" target="_blank" rel="noopener noreferrer">Variables<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for more information.</p> <h3 id="filters"><a href="#filters" class="header-anchor">#</a> Filters</h3> <p>You can modify the <a href="#variables">Variables</a> by piping the data to one or
more filters.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">foo</span><span class="token punctuation">:</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      name: {{ data.Name | capitalize }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>If the value of <code>data.Name</code> is <code>abc</code> then the Kloudless unified object is
<code>{'name':'Abc'}</code>. This example modifies the <code>data.Name</code> with a <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#capitalize" target="_blank" rel="noopener noreferrer">capitalize()
filter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Check <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#filters" target="_blank" rel="noopener noreferrer">Jinja
Filters<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and
<a href="#jinja-filter-extensions">Jinja Filter Extensions</a> for more information.</p> <h3 id="if"><a href="#if" class="header-anchor">#</a> If</h3> <p>Sometimes, you need to render the fields of an object conditionally. You can
use the <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#if" target="_blank" rel="noopener noreferrer">if
statement<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#if-expression" target="_blank" rel="noopener noreferrer">if
expression<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for this kind of usage.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">foo</span><span class="token punctuation">:</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      {% if data.Name is not None %}
      name: {{ data.Name }}
      {% endif %}
      email: {{ data.Email if '@' in data.Email else None }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="assignment"><a href="#assignment" class="header-anchor">#</a> Assignment</h3> <p>When you trying to convert some upstream codes to Kloudless unified codes,
you can leverage <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#assignments" target="_blank" rel="noopener noreferrer">Jinja
Assignments<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
to set up a dictionary and convert the codes by lookup the dictionary.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">foo</span><span class="token punctuation">:</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      {% set regions = {
        1: 'eu',
        2: 'us',
        3: 'cn',
      } %}
      region: {{ regions.get(data.Region) }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="context"><a href="#context" class="header-anchor">#</a> Context</h3> <p>You can provide a Jinja template context in the <a href="/guides/quickstart-storage.html#python-sdk-script">Python SDK
Script</a> which will render the object
with said context.</p> <p>For example, take the following KSpec:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">foo</span><span class="token punctuation">:</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      server: {{ context.server }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>With this KSpec, you can do something like this:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> client<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>from_upstream<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> interface_context<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'server'</span><span class="token punctuation">:</span> <span class="token string">'http://foo.com'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> include_raw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">{</span><span class="token string">'server'</span><span class="token punctuation">:</span> <span class="token string">'http://foo.com'</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="jinja-filter-extensions"><a href="#jinja-filter-extensions" class="header-anchor">#</a> Jinja Filter Extensions</h2> <p>In addition to <a href="https://jinja.palletsprojects.com/en/2.10.x/templates/#list-of-builtin-filters" target="_blank" rel="noopener noreferrer">Jinja2's builtin template
filters<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
the following filters are also available for use with the Kloudless Custom
Connector.</p> <h3 id="ref-transform"><a href="#ref-transform" class="header-anchor">#</a> ref_transform()</h3> <p>Renders a value by using the referenced transformation definition.</p> <p><code>ref_transform(context, value, transform_name)</code></p> <ul><li><code>context</code> - Template context. Required.</li> <li><code>value</code> - Value to transform. Required.</li> <li><code>transform_name</code> - Name of transformation reference. Required.</li></ul> <p>Usage example:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">children</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    data: {{ data.contents|ref_transform('file') }}</span>
<span class="token key atrule">file</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    id: {{ data.Id }}
    name: {{ data.DisplayName }}
    mime_type: {{ data.Type }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>In the above example, the <code>children</code> transforms would pass data['contents']
(a list) to the <code>file</code> transforms for parsing.</p> <p>A special feature about this filter is when given a single object, it will
produce the single parsed result; but if given a list, it will produce a list
of parsed results.</p> <p>It is possible to use <code>ref_transform()</code> to contain extra transformations to
avoid having multiple indentation levels.</p> <h3 id="timestring-to-unix"><a href="#timestring-to-unix" class="header-anchor">#</a> timestring_to_unix()</h3> <p>Converts a timestring to a
<a href="https://en.wikipedia.org/wiki/Unix_time" target="_blank" rel="noopener noreferrer">Unix timestamp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> format.</p> <p><code>timestring_to_unix(value)</code></p> <ul><li><code>value</code> - Timestring value to convert. Required.</li></ul> <p>Usage example:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> '2019<span class="token punctuation">-</span>09<span class="token punctuation">-</span>01T11<span class="token punctuation">:</span>00Z'<span class="token punctuation">|</span>timestring_to_unix <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This filter will convert <code>2019-09-01T11:00Z</code> to <code>1567335600.0</code>.</p> <p>Some services' API will return time information i.e. <code>created</code> or
<code>last_updated</code> with an ISO-8601 timestring. The Kloudless platform however,
accepts time information in Unix timestamp format. This filter can assist in
converting the time information if needed.</p> <h3 id="timestring-to-datetime"><a href="#timestring-to-datetime" class="header-anchor">#</a> timestring_to_datetime()</h3> <p>Converts a timestring to a datetime format.</p> <p><code>timestring_to_datetime(value)</code></p> <ul><li><code>value</code> - Timestring value to convert. Required.</li></ul> <p>Usage example:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> '2019<span class="token punctuation">-</span>09<span class="token punctuation">-</span>01T11<span class="token punctuation">:</span>00Z'<span class="token punctuation">|</span>timestring_to_datetime <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This filter will convert <code>2019-09-01T11:00Z</code> to a datetime object
<code>datetime(2019, 9, 1, 11, 0)</code>.</p> <p>While the Kloudless platform generally accepts the Unix timestamp format. There
are a few properties that use <code>datetime</code> instead. e.x. <code>event_time</code> for events
objects, or <code>expiry</code> in the notification_settings object.</p> <h3 id="expires-in-to-expiry"><a href="#expires-in-to-expiry" class="header-anchor">#</a> expires_in_to_expiry()</h3> <p>Adds the input seconds value with current Unix timestamp. This function can be
useful for converting the &quot;expires_in&quot; value in an access token response to the
absolute expiration timestamp (&quot;expires_at&quot;).</p> <p><code>expires_in_to_expiry(value)</code></p> <ul><li><code>value</code> - Unix timestamp value to convert. Required.</li></ul> <p>Usage example:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> 3600<span class="token punctuation">|</span>expires_in_to_expiry <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>In the example above, if the current timestamp is <code>1568171093.542906</code>, then
the filter will return the timestamp value of <code>1568174693.542906</code>.</p> <p>This filter will most likely be useful in access token parsing. Some access
token responses provide expire time in <code>expires_in</code>, while some others provide
the information as <code>expires_at</code>.</p> <h3 id="maybe-get"><a href="#maybe-get" class="header-anchor">#</a> maybe_get()</h3> <p>Similar to Python dictionary's <code>get()</code>, <code>maybe_get()</code> will retrieve a value
from a dictionary key, but will get the multi-level nested value in the
dictionary object, or return a default value if the key/value is otherwise
absent.</p> <p><code>maybe_get(value, *path, **kwargs)</code></p> <ul><li><code>value</code> - Value to retrieve from. This will be passed in automatically when
used as filter. Required.</li> <li><code>path</code> - Dictionary key in every nested level to get for.</li> <li><code>kwargs</code> - Currently the only useful keyword argument in templates is
<code>default=</code>. Provide this argument if you need a different default value
when <code>*path</code> doesn't exist in <code>value</code>. It would be <code>None</code> if not provided.</li></ul> <p>Usage example:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> data<span class="token punctuation">|</span>maybe_get('prop1'<span class="token punctuation">,</span> <span class="token string">'inner_key'</span><span class="token punctuation">,</span> default='default value') <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Given the following dictionary:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'prop1'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'inner_key'</span><span class="token punctuation">:</span> <span class="token string">'target value'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The result in the example will yield <code>target value</code>. If the definition of the
<code>data</code> dictionary is changed and any of the keys are different or not found,
the <code>default value</code> will be returned instead.</p> <h3 id="customized-jinja-filters"><a href="#customized-jinja-filters" class="header-anchor">#</a> Customized Jinja Filters</h3> <p>You can implement your own Jinja filter in <a href="/guides/quickstart-storage.html#python-sdk-script">Python SDK
Script</a>.</p> <p>You need to register your Jinja filter with the <code>@connector.service_filter</code>
Python decorator.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@connector<span class="token punctuation">.</span>service_filter</span>
<span class="token keyword">def</span> <span class="token function">your_filter</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> do_something<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Then, you can apply the filters in the KSpec.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">transforms</span><span class="token punctuation">:</span>
  <span class="token key atrule">foo</span><span class="token punctuation">:</span>
    <span class="token key atrule">from_upstream</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      boo: {{ data.Boo|your_filter }}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="transforms-exceptions"><a href="#transforms-exceptions" class="header-anchor">#</a> Transforms Exceptions</h2> <p>There are a few differences between the Kloudless Transforms and the
<a href="http://jinja.pocoo.org/docs" target="_blank" rel="noopener noreferrer">Jinja2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> template behavior. Certain patterns will
not work.</p> <div class="custom-block danger"><p class="custom-block-title">Don't:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">account_info</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    account: {{data.user_id}}@{{data.domain}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In some situations this may cause result like below and then YAML parsing
error. account: ‘123456’@’something.com'</p></div> <div class="custom-block tip"><p class="custom-block-title">Do:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">account_info</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    account: {{'%s@%s' % (data.user_id, data.domain)}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>KSpec Transforms will facilitate the necessary YAML escapes when rendering.
E.g.</p> <ul><li>'abc' -&gt; abc;</li> <li>&quot;I'm a sentence.&quot; -&gt; &quot;I'm a sentence&quot;;</li> <li>&quot;frank's friend said: &quot;okay...&quot;.&quot; -&gt; 'frank''s friend said: &quot;okay...&quot;.' .</li></ul></div> <div class="custom-block danger"><p class="custom-block-title">Don't:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">folder</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    name: '{{data.Name}}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>KSpec Transforms' internal mechanism will handle string quotations
if needed. Extra/Manual quotes may break the transformation.</p></div> <div class="custom-block tip"><p class="custom-block-title">Do:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">folder</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    name: {{data.Name}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Kspec transforms will handle numeric strings as well.
E.g.</p> <ul><li>{“Name”: “123”} -&gt; name: ‘123’</li> <li>{“Name”: 123} -&gt; name: 123</li></ul></div> <div class="custom-block danger"><p class="custom-block-title">Don't:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">event</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    metadata: {{data|ref_transform(‘event_meta’)}}
        extra_prop: {{data.something}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>extra_prop</code> above will cause an YAML parsing error. Try to avoid having
multiple levels of indentation as the KSpec transforms' internal mechanism
renders in flow style formatting, which will conflict with the block style
formatting shown above.</p></div> <div class="custom-block tip"><p class="custom-block-title">Do:</p> <p>In the event that additional variables are required (above), utilize
the following method instead:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">event</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    {% set parsed = data|ref_transform(‘event_meta’) %}
    {% set tmp = parsed.__setitem__(‘extra_prop’, data.something) %}
    metadata: {{parsed}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">Do:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>data<span class="token punctuation">|</span>ref_transform(‘ev_meta’)<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To render the result as an YAML list with a single item.</p></div> <div class="custom-block tip"><p class="custom-block-title">Do:</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token punctuation">{</span><span class="token punctuation">{</span> %s % data.value <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>or</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> data.value<span class="token punctuation">|</span>string <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To enforce a string type result.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guides/quickstart-storage.html" class="prev">
        Quickstart
      </a></span> <span class="next"><a href="/guides/authentication.html">
        Authentication
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a00be1cb.js" defer></script><script src="/assets/js/2.119f2a7d.js" defer></script><script src="/assets/js/10.0f7f8ee2.js" defer></script>
  </body>
</html>
